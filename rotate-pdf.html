<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Rotate PDF - PDFUniverse</title>
  <link rel="stylesheet" href="style.css"/>
  <style>
    .preview-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
    }
    .page-preview {
      width: 30%;
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
      position: relative;
    }
    .page-preview img {
      max-width: 100%;
      max-height: 400px;
      transition: transform 0.3s ease;
    }
    .rotate-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
    }
    .rotate-buttons button {
      padding: 5px 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <h1><a href="index.html" style="text-decoration:none; color:inherit;">PDFUniverse</a></h1>
  </header>

  <main>
    <h2>Rotate PDF Pages</h2>
    <input type="file" id="pdfUpload" accept="application/pdf"/>
    <div id="previewArea" class="preview-container"></div>
    <button onclick="downloadRotatedPDF()">Download Rotated PDF</button>
  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
  <script src="https://unpkg.com/pdfjs-dist/build/pdf.min.js"></script>
  <script>
    const previewArea = document.getElementById('previewArea');
    let pdfDoc = null;
    let pageRotations = [];

    document.getElementById('pdfUpload').addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = async function() {
        const typedarray = new Uint8Array(this.result);
        const loadingTask = pdfjsLib.getDocument({ data: typedarray });
        pdfDoc = await loadingTask.promise;

        const arrayBuffer = await file.arrayBuffer();
        const pdfLibDoc = await PDFLib.PDFDocument.load(arrayBuffer);
        pageRotations = Array(pdfLibDoc.getPageCount()).fill(0);

        previewArea.innerHTML = '';
        for (let i = 0; i < pdfDoc.numPages; i++) {
          const page = await pdfDoc.getPage(i + 1);
          const viewport = page.getViewport({ scale: 1.5 });
          const canvas = document.createElement('canvas');
          canvas.width = viewport.width;
          canvas.height = viewport.height;
          const context = canvas.getContext('2d');

          await page.render({ canvasContext: context, viewport }).promise;

          const img = document.createElement('img');
          img.src = canvas.toDataURL();
          img.dataset.index = i;

          const preview = document.createElement('div');
          preview.className = 'page-preview';
          preview.appendChild(img);

          const buttons = document.createElement('div');
          buttons.className = 'rotate-buttons';

          const rotateLeft = document.createElement('button');
          rotateLeft.textContent = '⟲ Rotate Left';
          rotateLeft.onclick = () => rotatePage(i, -90, img);

          const rotateRight = document.createElement('button');
          rotateRight.textContent = 'Rotate Right ⟳';
          rotateRight.onclick = () => rotatePage(i, 90, img);

          buttons.appendChild(rotateLeft);
          buttons.appendChild(rotateRight);
          preview.appendChild(buttons);

          previewArea.appendChild(preview);
        }
      };
      reader.readAsArrayBuffer(file);
    });

    function rotatePage(index, degree, imgElement) {
      pageRotations[index] = (pageRotations[index] + degree + 360) % 360;
      imgElement.style.transform = `rotate(${pageRotations[index]}deg)`;
    }

    async function downloadRotatedPDF() {
      const file = document.getElementById('pdfUpload').files[0];
      if (!file) return alert("Please upload a PDF first.");

      const arrayBuffer = await file.arrayBuffer();
      const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);

      pdfDoc.getPages().forEach((page, i) => {
        page.setRotation(PDFLib.degrees(pageRotations[i] || 0));
      });

      const pdfBytes = await pdfDoc.save();
      const blob = new Blob([pdfBytes], { type: 'application/pdf' });
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = 'rotated.pdf';
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>